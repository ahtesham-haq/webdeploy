name: Deploy to IIS Server

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: windows-latest
    steps:
      - name: Install Required Modules
        run: |
          Install-Module -Name PSWSMan -Force -SkipPublisherCheck
          Install-Module -Name Microsoft.PowerShell.Management -Force

      - name: Execute Remote PowerShell on IIS Server
        run: |
          $password = ConvertTo-SecureString ${{ secrets.IIS_PASSWORD }} -AsPlainText -Force
          $cred = New-Object System.Management.Automation.PSCredential(${{ secrets.IIS_USERNAME }}, $password)
          Invoke-Command -ComputerName ${{ secrets.IIS_SERVER }} -Credential $cred -ScriptBlock {
              cd D:\Inetpub\wwwroot\myDeploy
              git pull https://$env:GITHUB_USER:$env:GITHUB_PAT@github.com/your-username/your-repo.git
          }
        shell: pwsh
    env:
        GITHUB_USER: ${{ secrets.GITHUB_USER }}
        GITHUB_PAT: ${{ secrets.GITHUB_PAT }}
