name: Deploy to IIS Server

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: windows-latest
    steps:
      - name: Install WinRM
        run: |
          Install-Module -Name PSRemoting -Force -SkipPublisherCheck

      - name: Deploy to IIS via PowerShell
        run: |
          $password = ConvertTo-SecureString ${{ 'x8st?frlz5QE' }} -AsPlainText -Force
          $cred = New-Object System.Management.Automation.PSCredential(${{ secrets.ahtesham.ul.haq }}, $password)
          Invoke-Command -ComputerName ${{ localhost }} -Credential $cred -ScriptBlock {
              cd 'D:\Ahtesham ul haq\Projects\Learning\Github\webdeploy\WebApplicationMy'
              git pull https://$env:GITHUB_USER:$env:GITHUB_PAT@github.com/your-username/your-repo.git
          }
        shell: pwsh
    env:
        GITHUB_USER: ${{ ahtesham-haq }}
        GITHUB_PAT: ${{ secrets.GITHUB_TOKEN }}
